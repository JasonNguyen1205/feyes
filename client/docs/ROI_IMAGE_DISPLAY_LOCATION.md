# Device ROI Result Cards - Image Display Location Guide

**Date:** October 3, 2025

## ğŸ“ Image Location in UI

The **related images** (golden sample and captured image) are displayed **at the bottom of each ROI card**, after all the ROI details.

---

## ğŸ—ï¸ Complete ROI Card Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“± Device 1                          âœ“ PASS        â”‚  â† Device Card Header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Barcode: 20003548-0000003-1019720-101              â”‚
â”‚  ROI Status: 2 / 3 Passed (1 Failed)                â”‚  â† Device Info
â”‚  Success Rate: 66.7%                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” ROI Inspection Details                          â”‚  â† ROI Section Title
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ROI 1 [barcode]               âœ“ PASS        â”‚  â”‚  â† ROI Header
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ Barcode Value: ABC123                        â”‚  â”‚
â”‚  â”‚ Position: [3459, 2959, 4058, 3318]           â”‚  â”‚  â† ROI Details
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ğŸŒŸ Golden Sample    ğŸ“¸ Captured Image       â”‚  â”‚
â”‚  â”‚ [Golden Image]      [Captured Image]         â”‚  â”‚  â† IMAGES HERE!
â”‚  â”‚ Click to enlarge    Click to enlarge         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ROI 5 [compare]               âœ— FAIL        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ AI Similarity: 88.35%                        â”‚  â”‚
â”‚  â”‚ [Progress Bar: â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘]                  â”‚  â”‚
â”‚  â”‚ Threshold: 90.00%                            â”‚  â”‚
â”‚  â”‚ Match Result: âœ— Different                    â”‚  â”‚
â”‚  â”‚ Position: [3301, 3876, 3721, 4459]           â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ğŸŒŸ Golden Sample    ğŸ“¸ Captured Image       â”‚  â”‚
â”‚  â”‚ [Golden Image]      [Captured Image]         â”‚  â”‚  â† IMAGES HERE!
â”‚  â”‚ Click to enlarge    Click to enlarge         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ROI 6 [ocr]                   âœ“ PASS        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ OCR Text: PCB                                â”‚  â”‚
â”‚  â”‚ Position: [3727, 4294, 3953, 4485]           â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ğŸŒŸ Golden Sample    ğŸ“¸ Captured Image       â”‚  â”‚
â”‚  â”‚ [Golden Image]      [Captured Image]         â”‚  â”‚  â† IMAGES HERE!
â”‚  â”‚ Click to enlarge    Click to enlarge         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‚ Code Location

### File: `templates/professional_index.html`

### Function: `renderROIResults(roiResults)`
**Lines:** ~1457-1610

### Image Section: **Lines ~1558-1605**

```javascript
<!-- ROI Images Section -->
${(() => {
    // Handle both old and new image path formats
    const goldenSrc = roi.golden_image_path
        ? `/api/images/${encodeURIComponent(roi.golden_image_path)}`
        : roi.golden_image || '';

    const captureSrc = roi.roi_image_path
        ? `/api/images/${encodeURIComponent(roi.roi_image_path)}`
        : (roi.capture_image_file ? `/static/captures/${roi.capture_image_file}` : '');

    if (goldenSrc || captureSrc) {
        return `
            <div class="roi-images">
                ${goldenSrc ? `
                    <div class="roi-image-container">
                        <div class="roi-image-label">ğŸŒŸ Golden Sample</div>
                        <img src="${goldenSrc}" 
                             alt="Golden sample for ROI ${roi.roi_id}"
                             class="roi-image"
                             onclick="openImageModal(this.src, 'Golden Sample - ROI ${roi.roi_id}')"
                             onerror="[fallback SVG]">
                        <div class="roi-image-hint">Click to enlarge</div>
                    </div>
                ` : ''}
                ${captureSrc ? `
                    <div class="roi-image-container">
                        <div class="roi-image-label">ğŸ“¸ Captured Image</div>
                        <img src="${captureSrc}" 
                             alt="Captured image for ROI ${roi.roi_id}"
                             class="roi-image"
                             onclick="openImageModal(this.src, 'Captured Image - ROI ${roi.roi_id}')"
                             onerror="[fallback SVG]">
                        <div class="roi-image-hint">Click to enlarge</div>
                    </div>
                ` : ''}
            </div>
        `;
    }
    return '';
})()}
```

---

## ğŸ¨ CSS Styling

### Classes Used:

**`.roi-images`**
- Container for both images
- Uses CSS Grid (2 columns)
- Gap: 16px between images

**`.roi-image-container`**
- Individual image wrapper
- Hover effects
- Border and shadow styling

**`.roi-image-label`**
- Text label above image
- Shows "ğŸŒŸ Golden Sample" or "ğŸ“¸ Captured Image"

**`.roi-image`**
- The actual `<img>` element
- Max height: 200px
- Clickable (opens modal)
- Rounded corners

**`.roi-image-hint`**
- "Click to enlarge" text
- Appears on hover

---

## ğŸ–¼ï¸ Image Sources

### Two Image Formats Supported:

#### Old Format (Schema v1.0):
```javascript
golden_image: "data:image/jpeg;base64,/9j/4AAQ..."  // Base64 embedded
capture_image_file: "group_305_1200.jpg"            // Filename only
```

#### New Format (Schema v2.0):
```javascript
golden_image_path: "sessions/uuid/output/golden_1.jpg"  // Full path
roi_image_path: "sessions/uuid/output/roi_1.jpg"        // Full path
```

### Path Construction:

```javascript
// Golden Image
goldenSrc = roi.golden_image_path
    ? `/api/images/${encodeURIComponent(roi.golden_image_path)}`  // New format
    : roi.golden_image || '';                                      // Old format

// Captured Image  
captureSrc = roi.roi_image_path
    ? `/api/images/${encodeURIComponent(roi.roi_image_path)}`     // New format
    : (roi.capture_image_file 
        ? `/static/captures/${roi.capture_image_file}`             // Old format
        : '');
```

---

## ğŸ” Image Modal (Zoom Feature)

### Function: `openImageModal(src, caption)`
**Lines:** ~1620-1631

When user clicks an image:
1. Modal overlay appears (full screen)
2. Image displayed at larger size
3. Caption shows ROI info
4. Click outside or press ESC to close

```javascript
function openImageModal(src, caption) {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    const captionText = document.getElementById('modalCaption');

    modal.style.display = 'flex';
    modalImg.src = src;
    captionText.textContent = caption || '';
    
    document.body.style.overflow = 'hidden';  // Prevent background scroll
}
```

---

## ğŸ“± Responsive Behavior

### Desktop (> 768px):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒŸ Golden Sample   â”‚  ğŸ“¸ Captured Image  â”‚
â”‚  [Image]            â”‚  [Image]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Mobile (< 768px):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒŸ Golden Sample   â”‚
â”‚  [Image]            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“¸ Captured Image  â”‚
â”‚  [Image]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Display Logic

### Images Show When:
âœ… ROI has `golden_image_path` OR `golden_image` (base64)  
âœ… ROI has `roi_image_path` OR `capture_image_file`  

### Images Hidden When:
âŒ Both image sources are empty/null  
âŒ Image fails to load (shows "Image Unavailable" placeholder)

### Conditional Display:
```javascript
if (goldenSrc || captureSrc) {
    // Display image section
} else {
    return '';  // Skip image section entirely
}
```

---

## ğŸ› ï¸ Error Handling

### Image Load Failure:
When an image fails to load, the `onerror` handler:
1. Replaces image with SVG placeholder
2. Shows "Image Unavailable" text
3. Adds `.image-error` class to container

```javascript
onerror="this.onerror=null; 
         this.src='data:image/svg+xml,...[SVG placeholder]...'; 
         this.parentElement.classList.add('image-error');"
```

---

## ğŸ“Š Example ROI Types with Images

### Barcode ROI:
- **Details:** Barcode value, position
- **Images:** Golden barcode + Captured barcode
- **Use Case:** Verify barcode readability

### Compare ROI:
- **Details:** Similarity %, threshold, match result
- **Images:** Golden reference + Captured comparison
- **Use Case:** Visual defect detection

### OCR ROI:
- **Details:** OCR text, position
- **Images:** Golden text + Captured text
- **Use Case:** Text verification

---

## ğŸ”„ Data Flow

```
1. Server Response
   â””â”€> device_summaries[1].results[]
       â””â”€> roi_results[] with image paths

2. normalizeToV2()
   â””â”€> Converts v1.0 to v2.0 format

3. renderDeviceResults()
   â””â”€> Loops through devices
       â””â”€> Calls renderROIResults()

4. renderROIResults()
   â””â”€> Loops through ROIs
       â””â”€> Renders ROI card
           â””â”€> Renders image section (if images exist)
               â”œâ”€> Golden image
               â””â”€> Captured image

5. User clicks image
   â””â”€> openImageModal()
       â””â”€> Shows full-size image
```

---

## ğŸ“ Quick Reference

| Element | Location | Description |
|---------|----------|-------------|
| **ROI Card** | Lines 1475-1605 | Complete ROI item |
| **ROI Details** | Lines 1490-1556 | Text details (similarity, barcode, etc.) |
| **Image Section** | Lines 1558-1605 | Golden + Captured images |
| **Golden Image** | Lines 1572-1581 | Left image |
| **Captured Image** | Lines 1582-1591 | Right image |
| **Modal Zoom** | Lines 1620-1644 | Click-to-enlarge handler |

---

## ğŸ¨ Visual Example

**Actual rendered output:**

```html
<div class="roi-images">
    <div class="roi-image-container">
        <div class="roi-image-label">ğŸŒŸ Golden Sample</div>
        <img src="/api/images/sessions%2Fuuid%2Foutput%2Fgolden_1.jpg" 
             alt="Golden sample for ROI 1"
             class="roi-image"
             onclick="openImageModal(this.src, 'Golden Sample - ROI 1')">
        <div class="roi-image-hint">Click to enlarge</div>
    </div>
    
    <div class="roi-image-container">
        <div class="roi-image-label">ğŸ“¸ Captured Image</div>
        <img src="/static/captures/group_305_1200.jpg" 
             alt="Captured image for ROI 1"
             class="roi-image"
             onclick="openImageModal(this.src, 'Captured Image - ROI 1')">
        <div class="roi-image-hint">Click to enlarge</div>
    </div>
</div>
```

---

## âœ… Summary

**Location:** Inside each ROI card, at the bottom after all text details  
**Display:** Side-by-side (desktop) or stacked (mobile)  
**Interaction:** Click to open full-screen modal zoom  
**Fallback:** SVG placeholder if image fails to load  
**Format Support:** Both old (base64) and new (file paths)  

**Code File:** `templates/professional_index.html`  
**Function:** `renderROIResults(roiResults)`  
**Lines:** ~1558-1605 (Image Section)

---

**Last Updated:** October 3, 2025  
**Feature:** ROI Image Display  
**Status:** âœ… Fully Implemented
